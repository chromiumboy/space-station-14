- type: entity
  parent: BaseWeaponEnergyTurret
  id: WeaponTurretAIDefense
  name: automated AI defense turret
  description: A high-tech automated weapon system designed to protect sensitive areas.
  components:
  
  # Physics
  - type: Fixtures
    fixtures:
      body:
        shape:
          !type:PhysShapeCircle
          radius: 0.45
        density: 60
        mask:
          - Impassable
      turret:
        shape:
          !type:PhysShapeCircle
          radius: 0.45
        density: 60
        mask:
          - MachineMask
        layer:
          - MachineLayer
        hard: false
        
  # Sprites and appearance
  - type: Sprite
    sprite: Objects/Weapons/Guns/Turrets/ai_turret.rsi
    drawdepth: FloorObjects
    granularLayersRendering: true
    layers:
    - state: support
      renderingStrategy: NoRotation
    - state: base
      map: [ "base" ]
    - state: stun
      map: [ "enum.PopupTurretVisualLayers.Weapon" ]
      shader: "unshaded"
      visible: false
    - state: cover_closed
      map: [ "enum.PopupTurretVisualLayers.Turret" ]
      renderingStrategy: NoRotation
  - type: AnimationPlayer
  - type: Appearance
  - type: GenericVisualizer
    visuals:
      enum.BatteryWeaponFireModeVisuals.State:
        enum.PopupTurretVisualLayers.Weapon:
          BulletEnergyTurretDisabler: { state: stun }
          BulletEnergyTurretLaser: { state: lethal }
      enum.PopupTurretVisuals.Turret:
        enum.PopupTurretVisualLayers.Weapon:
          Retracted: { visible: false }
          Deploying: { visible: true }
          Deployed: { visible: true }
          Retracting: { visible: false }
      enum.RepairableTurretVisuals.Broken:
        base:
          True: { state: destroyed }
          False: { state: base }
        enum.PopupTurretVisualLayers.Weapon:
          True: { visible: false }
          False: { visible: true }
  
  # HTN
  - type: HTN
    enabled: false
  
  # Faction / control
  - type: StationAiWhitelist
  - type: StationAiTurret
  - type: NpcFactionMember
    factions:
    - AllHostile
  - type: AccessReader
    access: [["Command"]]
    
  # Weapon systems
  - type: ProjectileBatteryAmmoProvider
    proto: BulletEnergyTurretDisabler
    fireCost: 150
  - type: BatteryWeaponFireModes
    fireModes:
    - proto: BulletEnergyTurretDisabler
      fireCost: 150
    - proto: BulletEnergyTurretLaser
      fireCost: 150
  - type: TurretTargeting
    targetCyborgs: false
    authorizedAccessLevels:
    - Command
  
  # General properties
  - type: PopupTurret
    retractedDamageModifierSetId: Metallic
    deployedDamageModifierSetId: FlimsyMetallic 
  - type: UseDelay
    delay: 1.2
  - type: Damageable
    damageModifierSet: Metallic
  - type: Repairable
    doAfterDelay: 10
    allowSelfRepair: false
  - type: RepairableTurret
  - type: Destructible
    thresholds:
      - trigger:
          !type:DamageTrigger
          damage: 300
        behaviors:
          - !type:DoActsBehavior
            acts: [ "Breakage" ]
          - !type:PlaySoundBehavior
            sound:
              collection: MetalGlassBreak
  
  # Device network
  - type: DeviceNetwork
    deviceNetId: Wired
    receiveFrequencyId: TurretControl
    transmitFrequencyId: TurretControl
    prefix: device-address-prefix-turret
    sendBroadcastAttemptEvent: true
    examinableAddress: true
  - type: DeviceNetworkRequiresPower
  - type: WiredNetworkConnection